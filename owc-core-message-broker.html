<link rel="import" href="../polymer/polymer-element.html">

<!--MODULE-->
<dom-module id="owc-core-message-broker">
  
  <!--VIEW-->
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <h2>Hello [[prop1]]!</h2>
    <p>LASTUID: [[lastUid]]</p>
    
    <!--Test buttons for message broker functions test. Should be called by -->
    <button on-click="publish">TEST PUBLISH</button>
    <button on-click="subscribe">TEST SUBSCRIBE</button>
    <button on-click="unsubscribe">TEST UNSUSCRIBE</button>

  </template>

  <!--SCRIPT-->
  <script> 

    class OwcCoreMessageBroker extends Polymer.Element {
    
      static get is() { 
        return 'owc-core-message-broker'; 
      }

      //Get Properties
      static get properties() {
        return {
          prop1: {
            type: String,
            value: 'owc-core-message-broker'
          },

          topics: {
            type: Array,
            value:[]
          },

          lastUid: {
            type: Number,
            value : -1
          }
        };
      }

      /**
      * PUBLISH - This method is devoted to send a message to subscribed objects
      *
      * @param {?String} topic: event name to subscribe
      * @param {?String} data: callback parameter
      * @param {?String} target: subset of object to receive the messages
      * @return {boolean}
      */
      publish(){
        console.log("...message-broker 2.0 publish...")
      }

      /**
      * SUBSCRIBE - Subscribe a call back for a specific topic
      *
      * @param {?String} topic: event name to subscribe
      * @param {?Function} func: callback
      * @param {?String} target: subset of object to receive the messages
      * @return {String} generated token
      */
      subscribe(topic, func, target){
        console.log("...message-broker 2.0 suscribe...", topic, func, target);
        var self = this;
        if (!self.topics.hasOwnProperty(topic)) {
            self.topics[topic] = [];
        }
        var token = (++self.lastUid).toString();
        if (target) {
            console.log("owc-core-message-broker target: ", target)
            self.topics[topic].push({
                token: token,
                func: func,
                target: target
            });
        } else {
            console.log("no target");
            self.topics[topic].push({
                token: token,
                func: func
            });
        }
        console.log("owc-core-message-broker token: ", token)        
        return token;        
      }

      /**
      * UNSUBSCRIBE - Unsubscribe to an event via token
      *
      * @param {?Number} token: registration token
      * @return {boolean}
      */
      unsubscribe(){
        console.log("...message-broker 2.0 unsuscribe...")
      }
    }

    window.customElements.define(OwcCoreMessageBroker.is, OwcCoreMessageBroker);
  </script>



</dom-module>
